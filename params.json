{"name":"Jenkins rmv setup","tagline":"Jenkins和RVM的设置","body":"### 前言.\r\n最近装RVM搞了我2.3天，今天解决了。主要是配合着Jenkins使用后，会出现一些问题。下面我就分享总结下，遇到的问题和解决方法（主要是对ubuntu的操作和命令不是很熟）。\r\n最开始说是要使用RVM管理ruby，没啥说的装RVM呗。\r\n\r\n安装方法：\r\n\r\n   1. 下载 curl 。\r\n<br/>\r\n```\r\n$ sudo apt-get install curl\r\n```\r\n<br/>\r\n   2. 根据 RVM官网 上介绍的安装稳定版的.\r\n<br/>\r\n```\r\n$ \\curl -L https://get.rvm.io | bash -s stable\r\n```\r\n<br/>\r\n   3. 检测文档\r\n<br/>\r\n```\r\n$ sudo gedit ~/.bash_profile\r\n```\r\n<br/>\r\n进入文档检测是否有下面这句话：\r\n<br/>\r\n```\r\n[[ -s \"$HOME/.rvm/scripts/rvm\" ]] && . \"$HOME/.rvm/scripts/rvm\"  # This loads RVM into a shell session.\r\n```\r\n<br/>\r\n没有的话就加上。\r\n<br/>\r\n\r\n好了，感觉上是没什么了。我看了许多的RVM安装介绍也差不多就到此为止了，一句\r\n<br/>\r\n```\r\n$ rvm -v\r\n```\r\n<br/>\r\n就有显示版本号了。我不知道他们到底是不是这样就能OK了，但是我用的两台ubuntu 12 的电脑是不行的。\r\n<br/>\r\n给我的系统提示好像是， “rvm is not a function.”反正就是类似的，告诉我没有这个功能。\r\n<br/>\r\n虽然之前对ubuntu系统不是很了解，但是多多少少能猜出点来，应该是没有类似window的环境变量这个东西。或者文件没有生效需要重新加载\r\n<br/>\r\n所以后面就搜索了下，然后运行了这句话就OK了。\r\n<br/>\r\n```\r\n$ source ~/.bash_profile\r\n```\r\n<br/>\r\nrvm -v就能看到版本号了。RVM安装好了，没有问题了，然后我看jenkins这边加入rvm是什么什么情况。结果又是让我一阵头大。下面是在jenkins中的rvm语句。\r\n<br/>\r\n```\r\n#!/bin/bash\r\n                                                                  \r\nsource $HOME/.bash_profile\r\nrvm use 1.9.3@cucumber_test --create\r\nmv CI/cdc/Gemfile .\r\nbundle install\r\n```\r\n<br/>\r\n但是运行结果是：\r\n<br/>\r\n```\r\nRVM is not a function, selecting rubies with 'rvm use ...' will not work.\r\nYou need to change your terminal settings to allow shell login.\r\nPlease visit https://rvm.io/workflow/screen/ for example.\r\n```\r\n<br/>\r\n又是这个提示，但是我明明是加了source 的啊，然后我打印了一下$HOME 看下，结果就了然了 $HOME 的路径是 /var/lib/jenkins ，所以$HOME/.bash_profile这个文件肯定是没有的。\r\n<br/>\r\n后来了解到enkins有个启动账户，本来是想从账户下手解决的，但是看了jenkins许多的代码都没有找到方法。只有尝试修改路劲来了。我的解决办法是：\r\n<br/>\r\n首先针对$HOME/.bash_profile来下手，我在var/lib/jenkins下创建了个.bash_profile文件\r\n<br/>\r\n```\r\n$ touch /var/lib/jenkins/.bash_profile\r\n```\r\n<br/>\r\n然后再copy信息进入，由于后面还会遇到一些问题，我就不纠结的写出来了，直接写能最终的文档内容：\r\n<br/>\r\n```\r\nPATH=$PATH:/home/yourname/.rvm/bin #你的rvm的bin地址yourname 你替换，下面也是，直接写出绝对路劲\r\nexport PATH\r\n[[ -s \"/home/yourname/.rvm/scripts/rvm\" ]] && . \"/home/yourname/.rvm/scripts/rvm\"  # This loads RVM into a shell session.\r\n```\r\n<br/>\r\n然后保存，OK，rvm基本上就会在jenkins上生效了。\r\n<br/>\r\n但是在这之后还会遇到一个简单的问题，就是启动jenkins的账户权限不知，不能创建两个文件夹。\r\n<br/>\r\n```\r\n[workspace] $ /bin/bash /tmp/hudson630987861412496593.sh\r\nmkdir: 无法创建目录\"/usr/local/rvm/log/ruby-1.9.3-p448\": 权限不够\r\nFetching source index for http://rubygems.org/\r\n```\r\n<br/>\r\n那么我们根据提示来创建两个文件夹就OK了。\r\n<br/>\r\n```\r\n$ sudo mkdir /usr/local/rvm/log/ruby-1.9.3-P448\r\n$ sudo mkdir /usr/local/rvm/gems/ruby-1.9.3-P448@cucumber_test\r\n```\r\n<br/>\r\n再次运行jenkins就能看到正确的提示 。\r\n<br/>\r\n```\r\n[workspace] $ /bin/bash /tmp/hudson5002374412671699529.sh\r\nruby-1.9.3-p448 is not installed.\r\nTo install do: 'rvm install ruby-1.9.3-p448'\r\nFetching source index for http://rubygems.org/\r\n```\r\n<br/>","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}